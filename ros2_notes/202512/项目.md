# 1 小说阅读器

首先创建一个小说发布节点，用来下载和发布小说话题，然后创建一个小说阅读节点，用来订阅小说话题，合成语音并进行播放。

## 1.1 小说发布节点

首先使用ngix创建服务器，用户下载文件。
通过http请求库requests来下载服务器上的文件
由于小说是文字形式，从exmaple_interfaces库中导入String类型的接口，该接口的详细定义为string data内容。可以通过命令行查看

    ros2 interface show example_interfaces/msg/String 查看

在__init__中创建一个队列，用于存放要发布的小说段落，之后调用create_publisher创建话题发布者，传入三个参数，分别为：话题接口的类型，话题的名称和ROS2 的服务质量策略，如10表示保存历史消息的队列长度。

创建发布者之后，调用self.create_time(5, self.time_callback)创建一个定时器，参数为周期和回调函数，在该定时器中，调用发布者来发布数据，发布的数据从队列中获取，并打印日志，显示发布的情况。

## 1.2 小说订阅节点

先解决语音合成的问题，使用第三方库espeak-ng来合成语音，可通过apt安装语音合成引擎espeak-ng，之后使用pip3安装espeakng的Python库，方便通过python代码调用语音合成引擎。

因为朗读数据没有接收数据快，所以用一个队列来存放数据，然后通过self.create_subscription创建一个话题订阅者，共4个参数分别为话题类型String，话题名称novel，回调函数用于接受数据，以及ROS2的服务质量策略，如10表示保存历史消息队列的长度。若超过，会怎么样？丢弃！

当调用spin时，接受novel话题事件，该回调函数novel_callback会被自动调用，并将话题数据作为回调函数的参数而被传入。


创建完订阅者后，创建一个朗读线程，在该线程中调用espeakng.Speaker类的对象Speaker，并设置发音为中文，不断调用rclpy.ok()实时检测rclpy的状态，若正常，则不断循环判断队列中是否有数据，若有，则调用队列函数get获取数据，再调用speaer.say进行朗读，调用wait等待朗读结束。若没有数据，则调用time.sleep(1)，使当前线程休眠1s。


# 2 使用话题实现运动闭环控制-发布控制海龟画圆的话题

海龟模拟器会订阅运动控制命令（就是目标点x，y，需要执行的线速度，角速度和转角），同时发布当前的位置。为了能够在订阅和发布对应的话题，在创建功能包时需加入geometry_msgs和turtlesim依赖。

通过发布速度控制命令到话题/turtle1/cmd_vel便可以`控制海龟移动`，通过订阅/turtle1/pose可以`获得海龟的实时位置`。
`实时位置和速度控制都有`了，就可以`闭环控制海龟移动到指定位置`。

**所谓闭环控制是指通过对输出进行测量和反馈来调整系统的输入，使系统的输出更加接近期望值。**

## 2.1 实现反馈控制

不断检测海龟当前的位置和目标位置之间的误差，来实时调整发布的指令，最终使海龟达到指定目标点。

控制策略：距离大于0.1继续移动，角度差大于0.2则原地旋转，否则直行。

# 2.2 总结

通过以上两个项目，已经掌握了如何在代码中实现话题订阅和发布数据，顺便学习了闭环控制。

# 3 第一个实战项目：系统状态检测与可视化工具

**话题通信**最佳实践 

## 3.1 项目需求

首先需要明确需求

1. 可以看到系统的实时状态信息，包括：记录信息的时间，主机名称，CPU使用率，内存使用率，内存总大小，剩余内存，网络接收数据量和网络发送数据量；（获取系统状态信息）
2. 要有一个简单的界面，可以实时显示状态信息；（展现界面）
3. 能在局域网内其它主机上查看数据；（共享数据）

## 3.2 需求实现

1. 编写一个python节点获得系统信息，并通过话题发布出来；
2. 用C++编写一个显示节点，订阅该话题，并通过调用Qt进行界面显示；

至此，确定了每个节点的功能以及节点之间的关系，那么工程结构就算确定下来了。

每个话题都有对应的消息接口类型，若ROS 2已有的消息接口类型无法满足用户需求，那么就需要自定义一个新的消息接口类型。

## 3.3 系统信息获取和发布

## 3.4 使用C++调用Qt创建界面

ROS2 中大量工具使用Qt作为界面设计工具，如rqt都是基于Qt完成的。

学习如何在功能包中使用Qt

# 4 用Python服务通信实现人脸识别
# 5 用C++服务通信做一个巡逻海龟
# 6 手眼转换功能

python和C++，通过调用TF实现手眼转换功能




