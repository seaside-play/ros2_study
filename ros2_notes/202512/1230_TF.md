# 0 ROS 2 常用工具
TF，ROS 2基于话题通信设计的一套TF工具

坐标关系和旋转关系，机器人的旋转方向为右手定则，右手卷往的方向是正（+）方向。
x,y,z为坐标关系
A,B,C为旋转关系或者说roll，pitch和yaw分别是绕x，y，z轴旋转的欧拉角，单位为rad（弧度）

x轴视为食指，将y轴视为中指，将z轴视为拇指。顺序是x、y、z，且颜色是RGB颜色顺序。机器人的旋转方向是右手定则，用右手卷住的方向是正（+）方向

# 1 TF

TF可以实现坐标系的转换

## 1.1 坐标转换工具介绍

通过命令行使用TF

表示姿态(即旋转关系)的方式：

1. 使用四元数
2. 使用欧拉角，
3. 使用ROS 2中的 **mrpt2**工具，可以方便地获取不同姿态表示之间的对应关系和可视化

- 在真实机器人中： 
    - 固定不变的坐标关系使用静态坐标转换；
    - 而对于障碍物信息则使用动态的坐标转换；

区分静态坐标转换和动态坐标转换，其对应的话题分别是/tf_static和/tf。


## 1.2 通过python发布静态TF

创建**静态坐标广播类StaticTransformBroadcaster**来发布坐标消息，坐标消息由用户自己指定。

## 1.3 通过python发布动态TF

发布动态TF与发布静态TF相比，最大的不同在于动态TF需要不断向外发布！！！

创建**坐标广播类TransformBoardcaster**的sendTransform来发布坐标消息，坐标消息由用户根据实际情况填写。

查看动态坐标的发布结果，如下

ros2 run tf2_ros tf2_echo camer_link bottle_link

## 1.4 监听TF

在完成了静态和动态坐标发布之后，就需要进行订阅以便监听TF

### 1.4.1 Buffer()

是tf2 坐标变换缓冲区类（对应tf2_ros.Buffer类），self.buffer_ = Buffer() 的作用是在 Python 类中创建一个属于当前类实例的 tf2 坐标变换缓冲区对象，并通过实例属性buffer_保存（方便类内其他方法调用）。

创建TransformListener，buffer_用来保存缓存的坐标数据，由于是动态坐标发布，所以需要使用定时器不断轮询获取更新值，在定时器回调函数中，通过调用loopup_transform获得各个坐标系之间的转换结果，在通过四元数转欧拉角，获得最终的坐标变换结果。

最后可以得到各个link之间的转换关系

## 1.5 使用C++发布静态和动态TF

调用 ros2 run tf2_ros tf2_echo map base_link
出现如下错误：

 ros2 run tf2_ros tf2_echo map target_point 
 
[INFO] [1767150844.046558369] [tf2_echo]: Waiting for transform map ->  target_point: Invalid frame ID "map" passed to canTransform argument target_frame - frame does not exist

这里map居然是invalid 